# ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ (Calendar Data Flow)

## ğŸ“‹ ĞĞ³Ğ»Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ (Table of Contents)
1. [ĞĞ±Ñ‰Ğ°Ñ ÑÑ…ĞµĞ¼Ğ°](#Ğ¾Ğ±Ñ‰Ğ°Ñ-ÑÑ…ĞµĞ¼Ğ°-general-scheme)
2. [Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…](#1-Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº-Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…-data-source)
3. [Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…](#2-Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°-Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…-data-loading)
4. [ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ](#3-Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³-ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ-calendar-parsing)
5. [ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ĞµĞ¹](#4-Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ-Ğ²ÑĞµÑ…-ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ĞµĞ¹-merging-all-calendars)
6. [ĞšĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹](#5-ĞºĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ-ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹-event-classification)
7. [Ğ ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹](#6-Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³-ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹-event-rendering)
8. [Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑĞ¼Ğ¸](#7-ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ-ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑĞ¼Ğ¸-calendar-management)
9. [ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ² Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞµ](#8-Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ-Ğ²-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞµ-ui-display)
10. [ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¸ Ñ†Ğ²ĞµÑ‚Ğ°](#Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ-Ğ¸-Ñ†Ğ²ĞµÑ‚Ğ°-variables-and-colors)

---

## ğŸ”„ ĞĞ±Ñ‰Ğ°Ñ ÑÑ…ĞµĞ¼Ğ° (General Scheme)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Ğ˜Ğ¡Ğ¢ĞĞ§ĞĞ˜Ğš Ğ”ĞĞĞĞ«Ğ¥ (Data Source)                               â”‚
â”‚    Variables_URL.ini                                             â”‚
â”‚    â”œâ”€ iCalendar5 = https://p141-caldav.icloud.com/...          â”‚
â”‚    â”œâ”€ iCalendar5_name = "EQ-Ğ¢Ğ°ÑÑˆĞºĞ° Ğ›Ğ¸Ñ‡Ğ½Ñ‹Ğ¹"                     â”‚
â”‚    â””â”€ ActiveFeeds = MeasureFeed1|...|MeasureFeed5               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Ğ—ĞĞ“Ğ Ğ£Ğ—ĞšĞ Ğ”ĞĞĞĞ«Ğ¥ (Data Loading)                              â”‚
â”‚    OmniCal.ini â†’ [MeasureFeed5] WebParser                       â”‚
â”‚    â”œâ”€ URL=#iCalendar5#                                          â”‚
â”‚    â”œâ”€ RegExp=(?siU)(.*)$ â† Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ²ĞµÑÑŒ .ics Ñ„Ğ°Ğ¹Ğ»            â”‚
â”‚    â””â”€ FinishAction=[!CommandMeasure Reader_lua Refresh(1)]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ĞŸĞĞ Ğ¡Ğ˜ĞĞ“ ĞšĞĞ›Ğ•ĞĞ”ĞĞ Ğ¯ (Calendar Parsing)                        â”‚
â”‚    @Resources/Measures/Reader.lua                               â”‚
â”‚    â”œâ”€ Initialize() â†’ ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Feeds[1..5]                       â”‚
â”‚    â”œâ”€ Input(5) â†’ Ğ¿Ğ°Ñ€ÑĞ¸Ñ‚ .ics Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚                            â”‚
â”‚    â”‚   â””â”€ Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµÑ‚: SUMMARY, DTSTART, DTEND, DESCRIPTION      â”‚
â”‚    â””â”€ Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: Feeds[5] = [ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ1, ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ2, ...]          â”‚
â”‚                   ĞºĞ°Ğ¶Ğ´Ğ¾Ğµ Ñ SourceFeed=5                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ĞĞ‘ĞªĞ•Ğ”Ğ˜ĞĞ•ĞĞ˜Ğ• ĞšĞĞ›Ğ•ĞĞ”ĞĞ Ğ•Ğ™ (Merging All Calendars)              â”‚
â”‚    Reader.lua â†’ Merge()                                         â”‚
â”‚    â””â”€ AllEvents[] = Feeds[1] + Feeds[2] + ... + Feeds[5]       â”‚
â”‚       Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ¿Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ (Sort by time)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ĞšĞ›ĞĞ¡Ğ¡Ğ˜Ğ¤Ğ˜ĞšĞĞ¦Ğ˜Ğ¯ Ğ¡ĞĞ‘Ğ«Ğ¢Ğ˜Ğ™ (Event Classification)                â”‚
â”‚    @Resources/OmniCal_Events.lua                                â”‚
â”‚    â”œâ”€ collectEvents() â†’ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ AllEvents                     â”‚
â”‚    â””â”€ classify_events_for_day(day_offset) â†’ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€ÑƒĞµÑ‚:        â”‚
â”‚        â”œâ”€ Completed hidden (ÑĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½Ğ½Ñ‹Ğµ)               â”‚
â”‚        â”œâ”€ Completed visible (Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ñ‹Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½Ğ½Ñ‹Ğµ)              â”‚
â”‚        â”œâ”€ Current (Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğµ)                                     â”‚
â”‚        â”œâ”€ Future visible (Ğ±ÑƒĞ´ÑƒÑ‰Ğ¸Ğµ Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ñ‹Ğµ)                      â”‚
â”‚        â””â”€ Future hidden (ÑĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ Ğ±ÑƒĞ´ÑƒÑ‰Ğ¸Ğµ)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Ğ Ğ•ĞĞ”Ğ•Ğ Ğ˜ĞĞ“ Ğ¡ĞĞ‘Ğ«Ğ¢Ğ˜Ğ™ (Event Rendering)                         â”‚
â”‚    @Resources/OmniCal_Events_Renderer.lua                       â”‚
â”‚    â””â”€ MeterGroup() â†’ Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Shape Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñâ”‚
â”‚        â”œâ”€ Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ Y Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ Ğ½Ğ° ÑĞµÑ‚ĞºĞµ (Ğ¿Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸)            â”‚
â”‚        â”œâ”€ ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ Ñ†Ğ²ĞµÑ‚ Cal_N_Bg                              â”‚
â”‚        â””â”€ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ² OmniCal.ini                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. ĞĞ¢ĞĞ‘Ğ ĞĞ–Ğ•ĞĞ˜Ğ• (Display)                                        â”‚
â”‚    OmniCal.ini â†’ Shape/String Ğ¼ĞµÑ‚Ñ€Ñ‹                             â”‚
â”‚    â””â”€ Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ÑÑ‚ÑÑ Ğ½Ğ° Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹ ÑĞµÑ‚ĞºĞµ                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1. Ğ˜Ğ¡Ğ¢ĞĞ§ĞĞ˜Ğš Ğ”ĞĞĞĞ«Ğ¥ (Data Source)

### Ğ¤Ğ°Ğ¹Ğ»: `@Resources/Variables_URL.ini`

```ini
[Variables]
    ; ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ (Calendar name)
    iCalendar5_name = EQ-Ğ¢Ğ°ÑÑˆĞºĞ° Ğ›Ğ¸Ñ‡Ğ½Ñ‹Ğ¹
    
    ; URL ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ iCloud/Google (iCloud/Google calendar URL)
    iCalendar5=https://p141-caldav.icloud.com/published/2/MjIwMDAyMDE3OTIyMDAwMvpB2w1jkLlsgXfsEp0V7WDbddNzYHK9I3-XvSCBZlJe
    
    ; ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ğ¸ (Active calendars)
    ActiveFeeds=MeasureFeed1|MeasureFeed2|MeasureFeed3|MeasureFeed4|MeasureFeed5
```

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ…:**
- `iCalendarN` â€” URL .ics Ñ„Ğ°Ğ¹Ğ»Ğ° ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ (N = 1..10)
- `iCalendarN_name` â€” Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµĞ¼Ğ¾Ğµ Ğ¸Ğ¼Ñ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ
- `ActiveFeeds` â€” ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¼ĞµÑ€ WebParser Ñ‡ĞµÑ€ĞµĞ· Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ¸Ñ‚ĞµĞ»ÑŒ `|`

**ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñ‹:**
- Google Calendar: `https://calendar.google.com/calendar/ical/.../basic.ics`
- iCloud Calendar: `https://p141-caldav.icloud.com/published/2/...`

---

## 2. Ğ—ĞĞ“Ğ Ğ£Ğ—ĞšĞ Ğ”ĞĞĞĞ«Ğ¥ (Data Loading)

### Ğ¤Ğ°Ğ¹Ğ»: `OmniCal.ini`

```ini
[MeasureFeed5]
Measure=WebParser
UpdateRate=60                    ; ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 60 ÑĞµĞºÑƒĞ½Ğ´
URL=#iCalendar5#                 ; â† Ğ‘ĞµÑ€Ñ‘Ñ‚ URL Ğ¸Ğ· Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹
RegExp=(?siU)(.*)$               ; â† Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ²ĞµÑÑŒ Ñ„Ğ°Ğ¹Ğ» Ñ†ĞµĞ»Ğ¸ĞºĞ¾Ğ¼
DecodeCharacterReference=1       ; Ğ”ĞµĞºĞ¾Ğ´Ğ¸Ñ€ÑƒĞµÑ‚ HTML entities
Substitute=""                    
FinishAction=[!CommandMeasure Reader_lua Refresh(1)][!UpdateMeasure OmniCal_Skin_lua]
Disabled=0                       ; 0 = Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°, 1 = Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ°
DynamicVariables=1
```

**Ğ§Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚:**
1. WebParser Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ .ics Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ¿Ğ¾ URL ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 60 ÑĞµĞºÑƒĞ½Ğ´
2. RegExp Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ²ĞµÑÑŒ Ñ„Ğ°Ğ¹Ğ» ĞºĞ°Ğº Ğ¾Ğ´Ğ½Ñƒ ÑÑ‚Ñ€Ğ¾ĞºÑƒ
3. ĞŸĞ¾ÑĞ»Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğ¹ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ (`FinishAction`):
   - Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ `Reader_lua.Refresh(1)` Ğ´Ğ»Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
   - ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ `OmniCal_Skin_lua` Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµÑ€Ğ¸ÑĞ¾Ğ²ĞºĞ¸ UI

**Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒÑ:**
- Ğ•ÑĞ»Ğ¸ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½ Ñ‡ĞµÑ€ĞµĞ· UI, `Disabled=1` Ğ¸ `URL=''` (Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹)
- Ğ­Ñ‚Ğ¾ ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ‚ Ñ‚Ñ€Ğ°Ñ„Ğ¸Ğº Ğ´Ğ»Ñ Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ĞµĞ¹

---

## 3. ĞŸĞĞ Ğ¡Ğ˜ĞĞ“ ĞšĞĞ›Ğ•ĞĞ”ĞĞ Ğ¯ (Calendar Parsing)

### Ğ¤Ğ°Ğ¹Ğ»: `@Resources/Measures/Reader.lua`

### 3.1. Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ â€” `Initialize()`

```lua
function Initialize()
    Feeds = {}
    
    -- ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¼ĞµÑ€ (Get list of active measures)
    local AllMeasureNames = SELF:GetOption('MeasureName', '')
    -- ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: "MeasureFeed1|MeasureFeed2|MeasureFeed5"
    
    -- Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ Ñ„Ğ¸Ğ´Ğ¾Ğ² (Create feeds table)
    for MeasureName in AllMeasureNames:gmatch('[^%|]+') do
        table.insert(Feeds, {
            Measure = SKIN:GetMeasure(MeasureName),
            MeasureName = MeasureName,
            Raw = nil,
            Type = nil,
            Title = nil,
            Link = nil,
            Error = nil
        })
    end
end
```

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** 
```lua
Feeds = {
    [1] = {Measure = [MeasureFeed1], MeasureName = "MeasureFeed1", ...},
    [2] = {Measure = [MeasureFeed2], MeasureName = "MeasureFeed2", ...},
    [5] = {Measure = [MeasureFeed5], MeasureName = "MeasureFeed5", ...}
}
```

### 3.2. ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ñ„Ğ¸Ğ´Ğ° â€” `Input(feedIndex)`

```lua
function Input(f)  -- f = 5 Ğ´Ğ»Ñ MeasureFeed5
    -- ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ RAW Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· WebParser (Get RAW data from WebParser)
    local Raw = Feeds[f].Measure:GetStringValue()
    
    -- ĞĞ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ñ‚Ğ¸Ğ¿ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ (Identify calendar type)
    local Type = IdentifyType(Raw)  -- â†’ "iCalendar"
    
    -- Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ÑŒ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ (Extract calendar name)
    Feeds[f].Title = Raw:match('X%-WR%-CALNAME:(.-)\n') or 'Untitled'
    
    -- ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ (Parse events)
    local Items = {}
    for RawItem in Raw:gmatch('BEGIN:VEVENT.-END:VEVENT') do
        local Item = {}
        
        -- ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ (Main data)
        Item.Title = RawItem:match('SUMMARY:(.-)\n') or 'Untitled'
        Item.Title = Item.Title:gsub('\\', '')  -- Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ ÑĞºÑ€Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
        
        Item.Desc = RawItem:match('DESCRIPTION:(.-)\n') or nil
        if Item.Desc then
            Item.Desc = Item.Desc:gsub('<.->', '')  -- Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ HTML Ñ‚ĞµĞ³Ğ¸
            Item.Desc = Item.Desc:gsub('%s%s+', ' ')  -- Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ»Ğ¸ÑˆĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ñ‹
        end
        
        -- Ğ”Ğ°Ñ‚Ñ‹ (Dates)
        local dtstart = RawItem:match('DTSTART.-[^\r\n]+')
        Item.Date, Item.AllDay, Item.RealDate = IdentifyDate(dtstart, 'iCalendar')
        
        local dtend = RawItem:match('DTEND.-[^\r\n]+')
        if dtend then
            Item.DateEnd, _, _ = IdentifyDate(dtend, 'iCalendar')
        else
            -- Fallback: ĞµÑĞ»Ğ¸ Ğ½ĞµÑ‚ DTEND, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ +1 Ñ‡Ğ°Ñ Ğ¸Ğ»Ğ¸ +1 Ğ´ĞµĞ½ÑŒ
            local duration = (Item.AllDay == 1 and 86400 or 3600)
            Item.DateEnd = Item.Date + duration
        end
        
        -- Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ (Event source)
        local sourceNum = tonumber(Feeds[f].MeasureName:match('MeasureFeed(%d+)')) or f
        Item.SourceFeed = sourceNum  -- â† 5 Ğ´Ğ»Ñ MeasureFeed5
        
        -- ID Ğ´Ğ»Ñ Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ğ¾Ğ² (ID for duplicate detection)
        Item.ID = RawItem:match('UID:(.-)\n') or Item.Title
        
        -- Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ (Event link)
        local ev = os.date('*t', Item.Date)
        Item.Link = string.format('https://calendar.google.com/calendar/u/0/r/week/%d/%d/%d', 
                                   ev.year, ev.month, ev.day)
        
        table.insert(Items, Item)
    end
    
    -- Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ¿Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ (Sort by time)
    table.sort(Items, compareTime)
    
    -- Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ² Feeds[f] (Save events to Feeds[f])
    Feeds[f] = Items
end
```

**Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñ‹ Ğ´Ğ°Ñ‚ iCalendar:**
- `DTSTART:20251112T090000` â†’ 12.11.2025 09:00
- `DTSTART;VALUE=DATE:20251112` â†’ 12.11.2025 (Ğ²ĞµÑÑŒ Ğ´ĞµĞ½ÑŒ, AllDay=1)
- `DTSTART;TZID=Europe/Moscow:20251112T090000` â†’ ÑƒÑ‡Ñ‘Ñ‚ Ñ‡Ğ°ÑĞ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾ÑÑĞ°

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ `Input(5)`:**
```lua
Feeds[5] = {
    [1] = {
        Title = "Ğ’ÑÑ‚Ñ€ĞµÑ‡Ğ° Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ¼",
        Date = 1731398400,  -- Unix timestamp
        DateEnd = 1731402000,
        Desc = "ĞĞ±ÑÑƒĞ´Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚",
        SourceFeed = 5,
        AllDay = 0,
        Link = "https://calendar.google.com/calendar/u/0/r/week/2025/11/12",
        ID = "unique-event-id@google.com"
    },
    [2] = { ... },
    ...
}
```

---

## 4. ĞĞ‘ĞªĞ•Ğ”Ğ˜ĞĞ•ĞĞ˜Ğ• Ğ’Ğ¡Ğ•Ğ¥ ĞšĞĞ›Ğ•ĞĞ”ĞĞ Ğ•Ğ™ (Merging All Calendars)

### Ğ¤Ğ°Ğ¹Ğ»: `@Resources/Measures/Reader.lua`

```lua
function Update()
    -- ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºÑƒ Ğ²ÑĞµÑ… Ñ„Ğ¸Ğ´Ğ¾Ğ² (Check if all feeds are loaded)
    for i, feed in ipairs(Feeds) do
        if not (feed.Measure and feed.Measure:GetStringValue() ~= '') then
            return "Aguardando feeds..."
        end
    end
    
    -- ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ñ„Ğ¸Ğ´ (Process each active feed)
    for i = 1, #Feeds do
        Input(i)
    end
    
    -- ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¸Ğ· Ğ²ÑĞµÑ… Ñ„Ğ¸Ğ´Ğ¾Ğ² (Merge events from all feeds)
    local AllEvents = {}
    for i, feed in ipairs(Feeds) do
        if feed and type(feed) == 'table' then
            for j, event in ipairs(feed) do
                table.insert(AllEvents, event)
            end
        end
    end
    
    -- Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ¿Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ (Sort by time)
    table.sort(AllEvents, function(a, b)
        return (a.Date or 0) < (b.Date or 0)
    end)
    
    -- Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ² Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½ÑƒÑ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ (Save to global table)
    -- Ğ¸Ğ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· Rainmeter Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ
end
```

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:**
```lua
AllEvents = {
    {Title="Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ Ğ¸Ğ· Cal1", Date=..., SourceFeed=1},
    {Title="Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ Ğ¸Ğ· Cal2", Date=..., SourceFeed=2},
    {Title="Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ Ğ¸Ğ· Cal5", Date=..., SourceFeed=5},
    ...
}
-- Ğ’ÑĞµĞ³Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ 50-200+ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ¸Ğ· Ğ²ÑĞµÑ… ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ĞµĞ¹
```

---

## 5. ĞšĞ›ĞĞ¡Ğ¡Ğ˜Ğ¤Ğ˜ĞšĞĞ¦Ğ˜Ğ¯ Ğ¡ĞĞ‘Ğ«Ğ¢Ğ˜Ğ™ (Event Classification)

### Ğ¤Ğ°Ğ¹Ğ»: `@Resources/OmniCal_Events.lua`

### 5.1. ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ â€” `collectEvents()`

```lua
function collectEvents()
    -- ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½Ñ‘Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¸Ğ· Reader.lua
    -- Ğ§ĞµÑ€ĞµĞ· Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½ÑƒÑ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ Ğ¸Ğ»Ğ¸ SKIN Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ
    local all = {}
    -- ... ĞºĞ¾Ğ´ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ ...
    return all
end
```

### 5.2. ĞšĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ Ğ´Ğ½ÑĞ¼ â€” `classify_events_for_day()`

```lua
function classify_events_for_day(all, dayOffset, dayStartHour, startHour, endHour)
    -- dayOffset: 0=ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ, 1=Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°, 2=Ğ¿Ğ¾ÑĞ»ĞµĞ·Ğ°Ğ²Ñ‚Ñ€Ğ°, ...
    -- dayStartHour: Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ ÑÑƒÑ‚Ğ¾Ğº (Ğ´Ğ»Ñ psychological Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°)
    -- startHour: Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ğ¾Ğ¹ ÑĞµÑ‚ĞºĞ¸
    -- endHour: ĞºĞ¾Ğ½ĞµÑ† Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ğ¾Ğ¹ ÑĞµÑ‚ĞºĞ¸
    
    -- Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»Ğ¸Ñ‚ÑŒ Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ Ğ´Ğ½Ñ (Calculate day boundaries)
    local boundaries = calculate_day_boundaries(dayOffset, dayStartHour)
    -- boundaries = {
    --     start = 1731369600,  -- Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ ÑÑƒÑ‚Ğ¾Ğº (day start)
    --     end_time = 1731456000  -- ĞºĞ¾Ğ½ĞµÑ† ÑÑƒÑ‚Ğ¾Ğº (day end)
    -- }
    
    -- ĞšĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ (Classify events)
    local grouped = {
        ["Completed hidden"] = {},
        ["Completed visible"] = {},
        ["Current"] = {},
        ["Future visible"] = {},
        ["Future hidden"] = {}
    }
    
    local CT = os.time()  -- Current Time
    local startHourTime = boundaries.start + (startHour * 3600)
    local endHourTime = boundaries.start + (endHour * 3600)
    
    for _, event in ipairs(all) do
        local start = event.Date
        local end_time = event.DateEnd
        
        -- ĞŸÑ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ ĞµÑĞ»Ğ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ Ğ½Ğµ Ğ² ÑÑ‚Ğ¾Ğ¼ Ğ´Ğ½Ğµ
        if start >= boundaries.end_time or end_time <= boundaries.start then
            goto continue
        end
        
        -- Ğ“Ğ Ğ£ĞŸĞŸĞ˜Ğ ĞĞ’ĞšĞ (GROUPING):
        
        -- 1. Completed hidden: Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ¾ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° ÑĞµÑ‚ĞºĞ¸
        if start < startHourTime and end_time < CT then
            table.insert(grouped["Completed hidden"], event)
            
        -- 2. Completed visible: Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½Ğ½Ñ‹Ğµ Ğ² Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ğ¾Ğ¹ Ğ·Ğ¾Ğ½Ğµ
        elseif startHourTime <= start and start < CT and end_time <= CT then
            table.insert(grouped["Completed visible"], event)
            
        -- 3. Current: Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğµ (Ğ¸Ğ´ÑƒÑ‚ Ğ¿Ñ€ÑĞ¼Ğ¾ ÑĞµĞ¹Ñ‡Ğ°Ñ)
        elseif start < CT and CT < end_time then
            table.insert(grouped["Current"], event)
            
        -- 4. Future visible: Ğ±ÑƒĞ´ÑƒÑ‰Ğ¸Ğµ Ğ² Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ğ¾Ğ¹ Ğ·Ğ¾Ğ½Ğµ
        elseif CT < start and start < endHourTime then
            table.insert(grouped["Future visible"], event)
            
        -- 5. Future hidden: Ğ±ÑƒĞ´ÑƒÑ‰Ğ¸Ğµ Ğ¿Ğ¾ÑĞ»Ğµ ĞºĞ¾Ğ½Ñ†Ğ° ÑĞµÑ‚ĞºĞ¸
        elseif endHourTime <= start and start < boundaries.end_time then
            table.insert(grouped["Future hidden"], event)
        end
        
        ::continue::
    end
    
    -- ĞŸĞ¾Ğ´ÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ ÑĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ (Count hidden events)
    local beforeCount = #grouped["Completed hidden"]
    local afterCount = #grouped["Future hidden"]
    
    return {
        boundaries = boundaries,
        grouped = grouped,
        counts = {beforeCount = beforeCount, afterCount = afterCount}
    }
end
```

### 5.3. Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ´Ğ½ĞµĞ¹ â€” `M.Process()`

```lua
function M.Process()
    local startHour = tonumber(SKIN:GetVariable('startHour')) or 8
    local endHour = tonumber(SKIN:GetVariable('endHour')) or 4
    local dayStartHour = tonumber(SKIN:GetVariable('DayStartHour')) or startHour
    local displayedDays = tonumber(SKIN:GetVariable('DisplayedDays')) or 4
    
    local all = collectEvents()
    
    -- Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¼Ğ°ÑÑĞ¸Ğ² Ğ´Ğ½ĞµĞ¹ (Create days array)
    local days = {}
    for dayOffset = 0, displayedDays - 1 do
        days[dayOffset] = classify_events_for_day(all, dayOffset, dayStartHour, startHour, endHour)
    end
    
    -- Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾ (Save globally)
    CalendarEvents = {
        days = days,
        today = days[0],        -- ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ
        tomorrow = days[1],
        overmorrow = days[2]
    }
end
```

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° `CalendarEvents`:**
```lua
CalendarEvents = {
    days = {
        [0] = {  -- Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ (Today)
            boundaries = {start = ..., end_time = ...},
            grouped = {
                ["Completed hidden"] = {ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ1, ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ2, ...},
                ["Completed visible"] = {...},
                ["Current"] = {ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ3},  -- â† Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ
                ["Future visible"] = {ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ4, ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ5, ...},
                ["Future hidden"] = {...}
            },
            counts = {beforeCount = 2, afterCount = 5}
        },
        [1] = { ... },  -- Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ° (Tomorrow)
        [2] = { ... },  -- ĞŸĞ¾ÑĞ»ĞµĞ·Ğ°Ğ²Ñ‚Ñ€Ğ° (Overmorrow)
        ...
    }
}
```

---

## 6. Ğ Ğ•ĞĞ”Ğ•Ğ Ğ˜ĞĞ“ Ğ¡ĞĞ‘Ğ«Ğ¢Ğ˜Ğ™ (Event Rendering)

### Ğ¤Ğ°Ğ¹Ğ»: `@Resources/OmniCal_Events_Renderer.lua`

```lua
function MeterGroup()
    -- Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¸Ğ· OmniCal_Skin.lua:
    -- SKIN:Bang('!CommandMeasure', 'OmniCal_Events_lua', 'MeterGroup()')
    
    local startHour = tonumber(SKIN:GetVariable('startHour')) or 8
    local gridHeight = tonumber(SKIN:GetVariable('GridHeight')) or 600
    local hourHeight = gridHeight / 24  -- Ğ’Ñ‹ÑĞ¾Ñ‚Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ñ‡Ğ°ÑĞ° Ğ² Ğ¿Ğ¸ĞºÑĞµĞ»ÑÑ…
    
    -- ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ´Ğ½Ñ (Get today's events)
    local currentEvents = CalendarEvents.today.grouped["Current"]
    local futureEvents = CalendarEvents.today.grouped["Future visible"]
    
    local eventIndex = 1
    
    -- Ğ ĞµĞ½Ğ´ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ (Render current events)
    for _, event in ipairs(currentEvents) do
        local bgColor = SKIN:GetVariable('Cal_' .. event.SourceFeed .. '_Bg')
        
        -- Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»Ğ¸Ñ‚ÑŒ Y Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ Ğ½Ğ° ÑĞµÑ‚ĞºĞµ (Calculate Y position on grid)
        local eventTime = os.date('*t', event.Date)
        local eventHour = eventTime.hour + (eventTime.min / 60)
        local y = (eventHour - startHour) * hourHeight
        
        -- Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»Ğ¸Ñ‚ÑŒ Ğ²Ñ‹ÑĞ¾Ñ‚Ñƒ Ğ±Ğ»Ğ¾ĞºĞ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ (Calculate event block height)
        local duration = event.DateEnd - event.Date
        local durationHours = duration / 3600
        local height = durationHours * hourHeight
        
        -- Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¼ĞµÑ‚Ñ€ Ğ´Ğ»Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ (Create meter for event)
        local meterName = 'Event_' .. eventIndex
        
        SKIN:Bang('!SetOption', meterName, 'Meter', 'Shape')
        SKIN:Bang('!SetOption', meterName, 'X', '100')
        SKIN:Bang('!SetOption', meterName, 'Y', tostring(y))
        SKIN:Bang('!SetOption', meterName, 'Shape', 
            string.format('Rectangle 0,0,200,%d,5 | Fill Color %s | StrokeWidth 0', 
                          height, bgColor))
        
        -- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑÑ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ (Add event text)
        SKIN:Bang('!SetOption', meterName .. '_Text', 'Meter', 'String')
        SKIN:Bang('!SetOption', meterName .. '_Text', 'X', '110')
        SKIN:Bang('!SetOption', meterName .. '_Text', 'Y', tostring(y + 5))
        SKIN:Bang('!SetOption', meterName .. '_Text', 'Text', event.Title)
        
        SKIN:Bang('!UpdateMeter', meterName)
        SKIN:Bang('!UpdateMeter', meterName .. '_Text')
        
        eventIndex = eventIndex + 1
    end
    
    -- Ğ ĞµĞ½Ğ´ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ±ÑƒĞ´ÑƒÑ‰Ğ¸Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ (Render future events)
    for _, event in ipairs(futureEvents) do
        -- ... Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ¾ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¼ ...
    end
    
    SKIN:Bang('!Redraw')
end
```

**Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ‚:**
- **Y Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ**: `(eventHour - startHour) * hourHeight`
  - ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ Ğ² 14:30, startHour=8, hourHeight=25px
  - Y = (14.5 - 8) * 25 = 162.5px
- **Ğ’Ñ‹ÑĞ¾Ñ‚Ğ° Ğ±Ğ»Ğ¾ĞºĞ°**: `durationHours * hourHeight`
  - ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ Ğ´Ğ»Ğ¸Ñ‚ÑÑ 1.5 Ñ‡Ğ°ÑĞ°
  - Height = 1.5 * 25 = 37.5px

---

## 7. Ğ£ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• ĞšĞĞ›Ğ•ĞĞ”ĞĞ Ğ¯ĞœĞ˜ (Calendar Management)

### Ğ¤Ğ°Ğ¹Ğ»: `@Resources/OmniCal_Skin.lua`

### 7.1. ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ â€” `ToggleMeasureFeed5()`

```lua
function ToggleMeasureFeed5()
    ToggleFeed(5)
end
```

### 7.2. ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ â€” `ToggleFeed(feedIndex)`

```lua
function ToggleFeed(feedIndex)  -- feedIndex = 5
    local activeFeeds = SKIN:GetVariable('ActiveFeeds') or ''
    -- ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: "MeasureFeed1|MeasureFeed2|MeasureFeed5"
    
    -- ĞĞ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ğ¸ (Determine active calendars)
    local validFeeds = {}
    for n = 1, 10 do
        local url = SKIN:GetVariable('iCalendar' .. n)
        if url == nil then break end
        if url:match('https?://') then
            table.insert(validFeeds, n)
        end
    end
    -- validFeeds = {1, 2, 3, 4, 5}
    
    -- Ğ¡Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²Ğ¾ (Collect current set)
    local present = {}
    for n in activeFeeds:gmatch('MeasureFeed(%d+)') do
        local idx = tonumber(n)
        if idx then present[idx] = true end
    end
    -- present = {[1]=true, [2]=true, [5]=true}
    
    -- ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ (Toggle state)
    local feedName = "MeasureFeed" .. feedIndex
    if present[feedIndex] then
        present[feedIndex] = nil  -- ĞÑ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ (Disable)
    else
        present[feedIndex] = true  -- Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ (Enable)
    end
    
    -- Ğ¡Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ ÑÑ‚Ñ€Ğ¾ĞºÑƒ ActiveFeeds (Build new ActiveFeeds string)
    local parts = {}
    for _, n in ipairs(validFeeds) do
        if present[n] then 
            table.insert(parts, 'MeasureFeed' .. n) 
        end
    end
    activeFeeds = table.concat(parts, '|')
    -- activeFeeds = "MeasureFeed1|MeasureFeed2" (Ğ±ĞµĞ· 5)
    
    -- ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ†Ğ²ĞµÑ‚Ğ° ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ (Update button colors)
    local bgVar = "Cal_" .. feedIndex .. "_Bg"
    local bg = SKIN:GetVariable(bgVar) or '0,0,0,0'
    local r, g, b, a = string.match(bg, '(%d+),(%d+),(%d+),?(%d*)')
    
    local enabled = present[feedIndex] and true or false
    local newFill, newStroke
    
    if enabled then
        -- Ğ’ĞºĞ»ÑÑ‡Ñ‘Ğ½: Ğ½ĞµĞ¿Ñ€Ğ¾Ğ·Ñ€Ğ°Ñ‡Ğ½Ñ‹Ğ¹ (Enabled: opaque)
        newFill = r .. ',' .. g .. ',' .. b .. ',255'
        newStroke = r .. ',' .. g .. ',' .. b
    else
        -- ĞÑ‚ĞºĞ»ÑÑ‡Ñ‘Ğ½: Ğ¿Ğ¾Ñ‡Ñ‚Ğ¸ Ğ¿Ñ€Ğ¾Ğ·Ñ€Ğ°Ñ‡Ğ½Ñ‹Ğ¹ (Disabled: almost transparent)
        newFill = r .. ',' .. g .. ',' .. b .. ',1'
        newStroke = r .. ',' .. g .. ',' .. b
    end
    
    local fillVar = "Cal_" .. feedIndex .. "_FillColor"
    local strokeVar = "Cal_" .. feedIndex .. "_StrokColor"
    
    -- Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ² Variables.ini (Save to Variables.ini)
    SKIN:Bang('!WriteKeyValue', 'Variables', fillVar, newFill, '#@#Variables.ini')
    SKIN:Bang('!WriteKeyValue', 'Variables', strokeVar, newStroke, '#@#Variables.ini')
    SKIN:Bang('!WriteKeyValue', 'Variables', 'ActiveFeeds', activeFeeds, '#@#Variables_URL.ini')
    
    -- ĞÑ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ WebParser Ğ¼ĞµÑ€Ñ‹ (Disable inactive WebParser measures)
    for i = 1, 10 do
        local urlVar = 'iCalendar' .. i
        local url = SKIN:GetVariable(urlVar)
        if url == nil then break end
        
        local measureName = 'MeasureFeed' .. i
        if present[i] then
            SKIN:Bang('!SetOption', measureName, 'URL', url)
        else
            SKIN:Bang('!SetOption', measureName, 'URL', '')  -- ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ URL
        end
        SKIN:Bang('!UpdateMeasure', measureName)
    end
    
    -- ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ² Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸ (Update runtime variables)
    SKIN:Bang('!SetVariable', 'ActiveFeeds', activeFeeds)
    SKIN:Bang('!SetVariable', fillVar, newFill)
    SKIN:Bang('!SetVariable', strokeVar, newStroke)
    
    -- ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ ĞµÑĞ»Ğ¸ Ğ²ÑĞµ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ğ¸ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹
    -- (Clear event variables if all calendars are disabled)
    if activeFeeds == '' then
        local maxItems = tonumber(SKIN:GetVariable('NumberOfItems')) or 15
        for i = 1, maxItems do
            SKIN:Bang('!SetVariable', 'Item' .. i .. 'Title', '')
            SKIN:Bang('!SetVariable', 'Item' .. i .. 'Date', '')
            -- ... Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ ...
        end
    end
    
    -- ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ¾ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ (Update button visually)
    SKIN:Bang('!UpdateMeter', 'Cal_' .. feedIndex)
    
    -- ĞŸĞ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Sequential data update)
    SKIN:Bang('!CommandMeasure', 'Reader_lua', 'Initialize()')
    SKIN:Bang('!UpdateMeasure', 'Reader_lua')
    SKIN:Bang('!CommandMeasure', 'OmniCal_Events_lua', 'MeterGroup()')
    
    -- ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ Ğ¼ĞµÑ‚Ñ€Ñ‹ Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ (Update all data meters)
    SKIN:Bang('!UpdateMeterGroup', 'FeedData')
    
    -- ĞŸĞµÑ€ĞµÑ€Ğ¸ÑĞ¾Ğ²Ğ°Ñ‚ÑŒ (Redraw)
    SKIN:Bang('!Redraw')
end
```

---

## 8. ĞĞ¢ĞĞ‘Ğ ĞĞ–Ğ•ĞĞ˜Ğ• Ğ’ Ğ˜ĞĞ¢Ğ•Ğ Ğ¤Ğ•Ğ™Ğ¡Ğ• (UI Display)

### Ğ¤Ğ°Ğ¹Ğ»: `OmniCal.ini`

### 8.1. ĞšĞ½Ğ¾Ğ¿ĞºĞ° ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ

```ini
[Cal_5]
Meter=Shape
X=...
Y=...
Shape=Ellipse 15,15,15 | Fill Color #Cal_5_FillColor# | StrokeWidth 2 | Stroke Color #Cal_5_StrokColor#
DynamicVariables=1
LeftMouseUpAction=[!CommandMeasure OmniCal_Skin_lua "ToggleMeasureFeed5()"]
Group=CalendarButtons

[Cal_5_Text]
Meter=String
X=...
Y=...
Text=#iCalendar5_name#
FontColor=255,255,255,200
DynamicVariables=1
```

**Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ:**
- **Ğ’ĞºĞ»ÑÑ‡Ñ‘Ğ½**: `Cal_5_FillColor=50,150,200,255` (Ğ½ĞµĞ¿Ñ€Ğ¾Ğ·Ñ€Ğ°Ñ‡Ğ½Ñ‹Ğ¹, Ğ½Ğ°ÑÑ‹Ñ‰ĞµĞ½Ğ½Ñ‹Ğ¹)
- **ĞÑ‚ĞºĞ»ÑÑ‡Ñ‘Ğ½**: `Cal_5_FillColor=50,150,200,1` (Ğ¿Ğ¾Ñ‡Ñ‚Ğ¸ Ğ¿Ñ€Ğ¾Ğ·Ñ€Ğ°Ñ‡Ğ½Ñ‹Ğ¹, "ÑĞµÑ€Ñ‹Ğ¹")

### 8.2. Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ½Ğ° ÑĞµÑ‚ĞºĞµ

```ini
[Event_1]
Meter=Shape
X=100
Y=162  ; â† Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¾ Ğ¿Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
Shape=Rectangle 0,0,200,37,5 | Fill Color #Cal_5_Bg# | StrokeWidth 0
DynamicVariables=1
Group=FeedData

[Event_1_Text]
Meter=String
X=110
Y=167
Text=Ğ’ÑÑ‚Ñ€ĞµÑ‡Ğ° Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ¼
FontColor=255,255,255,255
ClipString=1
W=180
DynamicVariables=1
Group=FeedData
```

---

## ğŸ¨ ĞŸĞ•Ğ Ğ•ĞœĞ•ĞĞĞ«Ğ• Ğ˜ Ğ¦Ğ’Ğ•Ğ¢Ğ (Variables and Colors)

### Ğ¤Ğ°Ğ¹Ğ»: `@Resources/Variables.ini`

```ini
[Variables]
; Ğ¦Ğ²ĞµÑ‚Ğ° ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ĞµĞ¹ (Calendar button colors)
Cal_1_FillColor=...
Cal_1_StrokColor=...
Cal_2_FillColor=...
Cal_2_StrokColor=...
...
Cal_5_FillColor=50,150,200,255
Cal_5_StrokColor=50,150,200
```

### Ğ¤Ğ°Ğ¹Ğ»: `@Resources/Variables_Theme_Dark.ini`

```ini
[Variables]
; Ğ¡ĞĞ‘Ğ«Ğ¢Ğ˜Ğ• (Event) iCalendar 5
; Ğ¦Ğ²ĞµÑ‚ Ñ„Ğ¾Ğ½Ğ° Ğ´Ğ»Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ (Background color for events):
Cal_5_Bg=50,150,200,200

; "Ğ’Ñ‹Ñ†Ğ²ĞµÑ‚ÑˆĞ¸Ğ¹" Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑˆĞµĞ´ÑˆĞ¸Ñ… ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ (Faded variant for past events):
Cal_5_Bg_Faded=50,150,200,100
```

### Ğ¤Ğ°Ğ¹Ğ»: `@Resources/Variables_Theme_Light.ini`

```ini
[Variables]
; Ğ¡ĞĞ‘Ğ«Ğ¢Ğ˜Ğ• (Event) iCalendar 5
Cal_5_Bg=70,170,220,255
Cal_5_Bg_Faded=70,170,220,120
```

**ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ñ†Ğ²ĞµÑ‚Ğ¾Ğ²:**
- `Cal_N_FillColor` â€” Ğ·Ğ°Ğ»Ğ¸Ğ²ĞºĞ° ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ (alpha: 255=Ğ²ĞºĞ», 1=Ğ¾Ñ‚ĞºĞ»)
- `Cal_N_StrokColor` â€” Ğ¾Ğ±Ğ²Ğ¾Ğ´ĞºĞ° ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ
- `Cal_N_Bg` â€” Ñ„Ğ¾Ğ½ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ½Ğ° ÑĞµÑ‚ĞºĞµ (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ² Ñ€ĞµĞ½Ğ´ĞµÑ€ĞµÑ€Ğµ)
- `Cal_N_Bg_Faded` â€” Ñ„Ğ¾Ğ½ Ğ´Ğ»Ñ Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½Ğ½Ñ‹Ñ… ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ (Ğ¿Ñ€Ğ¸Ğ³Ğ»ÑƒÑˆÑ‘Ğ½Ğ½Ñ‹Ğ¹)

**N = SourceFeed** â€” Ğ½Ğ¾Ğ¼ĞµÑ€ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ, Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡Ñ‘Ğ½Ğ½Ñ‹Ğ¹ Ğ¸Ğ· `MeasureFeedN`

---

## ğŸ“ ĞŸĞĞ¡Ğ›Ğ•Ğ”ĞĞ’ĞĞ¢Ğ•Ğ›Ğ¬ĞĞĞ¡Ğ¢Ğ¬ ĞĞ‘ĞĞĞ’Ğ›Ğ•ĞĞ˜Ğ¯ (Update Sequence)

### ĞŸÑ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ ÑĞºĞ¸Ğ½Ğ°:
1. Rainmeter Ñ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ `Variables_URL.ini` â†’ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ `ActiveFeeds`, `iCalendar5`
2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ÑÑ Ğ¼ĞµÑ€Ğ° `[MeasureFeed5]` Ñ `URL=#iCalendar5#`
3. WebParser Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ .ics Ñ„Ğ°Ğ¹Ğ»
4. `FinishAction` â†’ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ `Reader_lua.Refresh(1)`
5. `Reader.lua` â†’ Ğ¿Ğ°Ñ€ÑĞ¸Ñ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ â†’ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ `Feeds[5]`
6. `OmniCal_Events.lua.Process()` â†’ ĞºĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€ÑƒĞµÑ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¿Ğ¾ Ğ´Ğ½ÑĞ¼
7. `OmniCal_Events_Renderer.lua.MeterGroup()` â†’ Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¼ĞµÑ‚Ñ€Ñ‹
8. `OmniCal.ini` â†’ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ½Ğ° ÑĞµÑ‚ĞºĞµ

### ĞŸÑ€Ğ¸ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¸ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ (ĞºĞ»Ğ¸Ğº Ğ½Ğ° Cal_5):
1. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ĞºĞ»Ğ¸ĞºĞ°ĞµÑ‚ â†’ `ToggleMeasureFeed5()`
2. `ToggleFeed(5)` â†’ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ `ActiveFeeds`, Ñ†Ğ²ĞµÑ‚Ğ°, URL
3. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² `.ini` Ñ„Ğ°Ğ¹Ğ»Ñ‹
4. `Reader_lua.Initialize()` â†’ Ğ¿ĞµÑ€ĞµÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ `Feeds[]` Ğ¿Ğ¾ Ğ½Ğ¾Ğ²Ğ¾Ğ¼Ñƒ `ActiveFeeds`
5. `Reader_lua.Update()` â†’ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ñ„Ğ¸Ğ´Ñ‹
6. `OmniCal_Events_lua.MeterGroup()` â†’ Ğ¿ĞµÑ€ĞµĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¼ĞµÑ‚Ñ€Ñ‹
7. `!Redraw` â†’ Ğ¿ĞµÑ€ĞµÑ€Ğ¸ÑĞ¾Ğ²Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ

### ĞŸÑ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 60 ÑĞµĞºÑƒĞ½Ğ´):
1. WebParser Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ `[MeasureFeed5]`
2. `FinishAction` â†’ `Reader_lua.Refresh(1)`
3. Ğ”Ğ°Ğ»ĞµĞµ ĞºĞ°Ğº Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ (ÑˆĞ°Ğ³Ğ¸ 5-8)

---

## ğŸ” ĞĞ¢Ğ›ĞĞ”ĞšĞ (Debugging)

### Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸:
```ini
[Variables]
DebugMode=1
```

### Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸:
- `@Resources/Debug/CalendarEvents_dump.txt` â€” Ğ´Ğ°Ğ¼Ğ¿ Ğ²ÑĞµÑ… ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ñ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¾Ğ¹
- `@Resources/Debug/CalendarGRID_dump.txt` â€” Ğ´Ğ°Ğ¼Ğ¿ ÑĞµÑ‚ĞºĞ¸ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ
- `@Resources/Debug/LOG.txt` â€” Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ Ğ»Ğ¾Ğ³

### ĞÑ‚Ğ»Ğ°Ğ´Ğ¾Ñ‡Ğ½Ñ‹Ğµ print() Ğ² Lua:
```lua
print("====SF: Reader.lua - Input(): sourceNum=" .. sourceNum)
print("====DESC: OmniCal_Events.lua - Process(): Title=" .. event.Title .. " DESC=" .. event.Desc)
```

Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ²Ñ‹Ğ²Ğ¾Ğ´ÑÑ‚ÑÑ Ğ² Rainmeter Log (F3 Ğ¸Ğ»Ğ¸ More â†’ Skins â†’ Open log)

---

## ğŸ“š Ğ¡Ğ’Ğ¯Ğ—ĞĞĞĞ«Ğ• Ğ¤ĞĞ™Ğ›Ğ« (Related Files)

### ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ:
- `@Resources/Variables_URL.ini` â€” URL ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ĞµĞ¹, ActiveFeeds
- `@Resources/Variables.ini` â€” Ñ†Ğ²ĞµÑ‚Ğ° ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº, Ğ¾Ğ±Ñ‰Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
- `@Resources/Variables_Theme_Dark.ini` â€” Ñ†Ğ²ĞµÑ‚Ğ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ (Ñ‚Ñ‘Ğ¼Ğ½Ğ°Ñ Ñ‚ĞµĞ¼Ğ°)
- `@Resources/Variables_Theme_Light.ini` â€” Ñ†Ğ²ĞµÑ‚Ğ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ (ÑĞ²ĞµÑ‚Ğ»Ğ°Ñ Ñ‚ĞµĞ¼Ğ°)

### Lua ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ñ‹:
- `@Resources/Measures/Reader.lua` â€” Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ .ics Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
- `@Resources/OmniCal_Events.lua` â€” ĞºĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
- `@Resources/OmniCal_Events_Renderer.lua` â€” Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³ Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²
- `@Resources/OmniCal_Skin.lua` â€” ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ UI, Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸

### Rainmeter:
- `OmniCal.ini` â€” Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» ÑĞºĞ¸Ğ½Ğ°, Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ¸ Ğ¼ĞµÑ€Ñ‹

### Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ:
- `@Resources/_dok/ĞšĞ°Ğº Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ.md` â€” Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ñ Ğ¿Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ
- `@Resources/_dok/ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… ĞºĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€Ñ.md` â€” ÑÑ‚Ğ¾Ñ‚ Ñ„Ğ°Ğ¹Ğ»

---

## âš™ï¸ Ğ¢Ğ•Ğ¥ĞĞ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ• Ğ”Ğ•Ğ¢ĞĞ›Ğ˜ (Technical Details)

### Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ .ics (iCalendar):
```
BEGIN:VCALENDAR
VERSION:2.0
X-WR-CALNAME:EQ-Ğ¢Ğ°ÑÑˆĞºĞ° Ğ›Ğ¸Ñ‡Ğ½Ñ‹Ğ¹
BEGIN:VEVENT
UID:unique-id@google.com
SUMMARY:Ğ’ÑÑ‚Ñ€ĞµÑ‡Ğ° Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ¼
DESCRIPTION:ĞĞ±ÑÑƒĞ´Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚
DTSTART:20251112T090000
DTEND:20251112T103000
END:VEVENT
BEGIN:VEVENT
...
END:VEVENT
END:VCALENDAR
```

### Unix Timestamp:
- `Date` Ğ¸ `DateEnd` Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ ĞºĞ°Ğº Unix timestamp (ÑĞµĞºÑƒĞ½Ğ´Ñ‹ Ñ 01.01.1970)
- ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: `os.time({year=2025, month=11, day=12, hour=9, min=0, sec=0})`
- ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ğ¾: `os.date('*t', timestamp)` â†’ `{year=2025, month=11, day=12, hour=9, ...}`

### Ğ ĞµĞ¶Ğ¸Ğ¼Ñ‹ Ğ´Ğ½Ñ (Day Modes):
- **Normal**: Ğ¡ÑƒÑ‚ĞºĞ¸ Ñ 00:00 Ğ´Ğ¾ 00:00 ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ³Ğ¾ Ğ´Ğ½Ñ
- **Psychological**: Ğ¡ÑƒÑ‚ĞºĞ¸ Ñ `DayStartHour` Ğ´Ğ¾ `DayStartHour` ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ³Ğ¾ Ğ´Ğ½Ñ
  - ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, ĞµÑĞ»Ğ¸ ÑĞµĞ¹Ñ‡Ğ°Ñ 01:50 Ğ¸ `DayStartHour=9`, Ñ‚Ğ¾ "ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ" = Ñ 09:00 Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ³Ğ¾ Ğ´Ğ½Ñ Ğ´Ğ¾ 09:00 Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ´Ğ½Ñ

### ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ:
- ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ 200 ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹: ~100-300 Ğ¼Ñ
- ĞšĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ: ~50-100 Ğ¼Ñ
- Ğ ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³ 50 Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²: ~100-200 Ğ¼Ñ
- **Ğ˜Ñ‚Ğ¾Ğ³Ğ¾**: Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ ~300-600 Ğ¼Ñ

---

**ĞĞ²Ñ‚Ğ¾Ñ€ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°:** AI Assistant (GitHub Copilot)  
**Ğ”Ğ°Ñ‚Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ:** 12 Ğ½Ğ¾ÑĞ±Ñ€Ñ 2025 Ğ³.  
**Ğ’ĞµÑ€ÑĞ¸Ñ:** 1.0
